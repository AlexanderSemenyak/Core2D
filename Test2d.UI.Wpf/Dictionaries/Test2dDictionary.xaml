<!-- Copyright (c) Wiesław Šoltés. All rights reserved. -->
<!-- Licensed under the MIT license. See LICENSE file in the project root for full license information. -->
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:sys="clr-namespace:System;assembly=mscorlib"
                    xmlns:core="clr-namespace:Test2d;assembly=Test2d"
                    xmlns:converters="clr-namespace:Test.Converters"
                    xmlns:controls="clr-namespace:Test.Controls"
                    xmlns:p="clr-namespace:Test2d.UI.Wpf.Properties">
    <!-- converters -->
    <converters:ArgbColorToBrushConverter x:Key="ArgbColorToBrushConverter"/>
    <converters:ArgbColorToBrushMultiConverter x:Key="ArgbColorToBrushMultiConverter"/>
    <converters:BooleanToStringConverter x:Key="BooleanToStarConverter" FalseValue="" TrueValue="*"/>
    <converters:DoubleToStringConverter x:Key="DoubleToStringConverter"/>
    <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
    <converters:FlagsEnumConverter x:Key="FontStyleFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="StateFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="MagLengthFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="StartStateFlagsEnumConverter"/>
    <converters:FlagsEnumConverter x:Key="EndStateFlagsEnumConverter"/>
    <converters:ObjectEqualityConverter x:Key="ObjectEqualityConverter"/>
    <converters:ColumnParameterConverter x:Key="ColumnParameterConverter"/>
    <converters:RecordParameterConverter x:Key="RecordParameterConverter"/>
    <converters:ValueParameterConverter x:Key="ValueParameterConverter"/>
    <converters:ShapeBindingParameterConverter x:Key="ShapeBindingParameterConverter"/>
    <converters:ShapePropertyParameterConverter x:Key="ShapePropertyParameterConverter"/>
    <converters:ZoomScaleConverter x:Key="ZoomScaleConverter"/>
    <!-- enums -->
    <ObjectDataProvider x:Key="MoveModeValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:MoveMode"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="TextHAlignmentValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:TextHAlignment"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="TextVAlignmentValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:TextVAlignment"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="ArrowTypeValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:ArrowType"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="LineCapValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:LineCap"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="XSweepDirectionValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:XSweepDirection"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider x:Key="XFillRuleValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="core:XFillRule"/>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <!-- brushes -->
    <SolidColorBrush x:Key="DarkSquareColor" Color="DarkGray" />
    <SolidColorBrush x:Key="LightSquareColor" Color="LightGray" />
    <DrawingBrush x:Key="CheckerBoard" Viewport="0,0,20,20" ViewportUnits="Absolute" Stretch="None" TileMode="Tile">
        <DrawingBrush.Drawing>
            <DrawingGroup>
                <GeometryDrawing Brush="{DynamicResource DarkSquareColor}">
                    <GeometryDrawing.Geometry>
                        <GeometryGroup>
                            <RectangleGeometry Rect="0,0,10,10"/>
                            <RectangleGeometry Rect="10,10,10,10"/>
                        </GeometryGroup>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
                <GeometryDrawing Brush="{DynamicResource LightSquareColor}">
                    <GeometryDrawing.Geometry>
                        <GeometryGroup>
                            <RectangleGeometry Rect="10,0,10,10"/>
                            <RectangleGeometry Rect="0,10,10,10"/>
                        </GeometryGroup>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingGroup>
        </DrawingBrush.Drawing>
    </DrawingBrush>
    <!-- path -->
    <DataTemplate DataType="{x:Type core:XPathSize}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="Width" 
                Margin="5,2,5,2" 
                Grid.Row="0" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBlock 
                Text="Height" 
                Margin="5,2,5,2" 
                Grid.Row="1" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBox 
                Text="{Binding Width, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}"
                Margin="5,2,5,2"
                Grid.Row="0" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
            <TextBox 
                Text="{Binding Height, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}" 
                Margin="5,2,5,2"
                Grid.Row="1" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPathRect}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <TextBlock 
                Text="X" 
                Margin="5,2,5,2" 
                Grid.Row="0" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBlock 
                Text="Y" 
                Margin="5,2,5,2" 
                Grid.Row="1" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBlock 
                Text="Width" 
                Margin="5,2,5,2" 
                Grid.Row="2" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBlock 
                Text="Height" 
                Margin="5,2,5,2" 
                Grid.Row="3" 
                Grid.Column="0" 
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBlock>
            <TextBox 
                Text="{Binding X, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}"
                Margin="5,2,5,2"
                Grid.Row="0" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
            <TextBox 
                Text="{Binding Y, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}" 
                Margin="5,2,5,2"
                Grid.Row="1" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
            <TextBox 
                Text="{Binding Width, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}"
                Margin="5,2,5,2"
                Grid.Row="2" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
            <TextBox 
                Text="{Binding Height, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                BorderBrush="{x:Null}" 
                Margin="5,2,5,2"
                Grid.Row="3" 
                Grid.Column="1" 
                Grid.ColumnSpan="2"
                TextAlignment="Left" 
                VerticalAlignment="Center">
            </TextBox>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XArcSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="RotationAngle" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsLargeArc" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="SweepDirection" 
                        Margin="5,2,5,2" 
                        Grid.Row="2" 
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="3"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="4"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBox 
                        Text="{Binding RotationAngle, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsLargeArc}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=XSweepDirectionValues}}" 
                        SelectedItem="{Binding SweepDirection}" 
                        Margin="5,2,5,2" 
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </ComboBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="3" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="4" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Point">
                <ContentControl Content="{Binding Point}"/>
            </Expander>
            <Expander Header="Size">
                <ContentControl Content="{Binding Size}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XBezierSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XLineSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Point">
                <ContentControl Content="{Binding Point}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyBezierSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    BorderThickness="0"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyLineSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPolyQuadraticBezierSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Points">
                <ListBox
                    ItemsSource="{Binding Points}"
                    BorderBrush="{x:Null}"
                    HorizontalContentAlignment="Stretch"
                    Height="140">
                </ListBox>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XQuadraticBezierSegment}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsSmoothJoin" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsStroked}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsSmoothJoin}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPathFigure}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="IsFilled" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <TextBlock 
                        Text="IsClosed" 
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsFilled}"
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
                <CheckBox 
                        Content=""
                        IsChecked="{Binding IsClosed}"
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </CheckBox>
            </Grid>
            <Expander Header="StartPoint">
                <ContentControl Content="{Binding StartPoint}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPathGeometry}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                        Text="FillRule" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                </TextBlock>
                <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=XFillRuleValues}}" 
                        SelectedItem="{Binding FillRule}" 
                        Margin="5,2,5,2" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                </ComboBox>
            </Grid>
            <TabControl>
                <TabItem Header="Bounds">
                    <ContentControl Content="{Binding Bounds}"/>
                </TabItem>
                <TabItem Header="Figures">
                    <TreeView 
                        x:Name="tree" 
                        ItemsSource="{Binding Figures}"
                        Margin="5,2,5,2">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Segments}">
                                <HierarchicalDataTemplate.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="True"/>
                                    </Style>
                                </HierarchicalDataTemplate.ItemContainerStyle>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"/>
                                    </DataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                                <TextBlock Text="{Binding}"/>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </TabItem>
                <TabItem Header="Selected">
                    <ContentControl 
                        Content="{Binding}"                
                        DataContext="{Binding ElementName=tree, Path=SelectedItem}"
                        Margin="5,5,5,5"
                        Grid.Column="2">
                    </ContentControl>
                </TabItem>
            </TabControl>
        </StackPanel>
    </DataTemplate>
    <!-- shape -->
    <ControlTemplate x:Key="NameControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Name" 
                       Margin="5,2,5,2" 
                       Grid.Row="0" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="0" 
                     Grid.Column="1" 
                     TextAlignment="Left" 
                     VerticalAlignment="Center">
            </TextBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="StyleControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Style" 
                       Margin="5,2,5,2" 
                       Grid.Row="0" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <ComboBox ItemsSource="{Binding Path=DataContext.Editor.Project.CurrentStyleLibrary.Styles, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                      SelectedItem="{Binding Path=DataContext.Style, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type StackPanel}}}"
                      Margin="5,2,5,2"
                      Grid.Row="0" 
                      Grid.Column="1">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="StateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=State, Converter={StaticResource StateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="IsStrokedControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="IsStroked" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
            </TextBlock>
            <CheckBox Content=""
                        IsChecked="{Binding IsStroked}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Margin="5,2,5,2">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="IsFilledControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="IsFilled" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
            </TextBlock>
            <CheckBox Content=""
                        IsChecked="{Binding IsFilled}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Margin="5,2,5,2">
            </CheckBox>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="TextControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Text" 
                       Margin="5,2,5,2" 
                       Grid.Row="0" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="0" 
                     Grid.Column="1" 
                     TextAlignment="Left" 
                     VerticalAlignment="Center">
            </TextBox>
        </Grid>
    </ControlTemplate>
    <!-- style -->
    <ControlTemplate x:Key="FontStyleControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Regular" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Regular}}">
            </CheckBox>
            <CheckBox Content="Bold" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Bold}}">
            </CheckBox>
            <CheckBox Content="Italic" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Italic}}">
            </CheckBox>
            <CheckBox Content="Underline" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Underline}}">
            </CheckBox>
            <CheckBox Content="Strikeout" Margin="1"
                      IsChecked="{Binding Path=FontStyle, Converter={StaticResource FontStyleFlagsEnumConverter}, ConverterParameter={x:Static core:FontStyle.Strikeout}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="MaxLengthControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Disabled" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Disabled}}">
            </CheckBox>
            <CheckBox Content="Start" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Start}}">
            </CheckBox>
            <CheckBox Content="End" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.End}}">
            </CheckBox>
            <CheckBox Content="Vertical" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Vertical}}">
            </CheckBox>
            <CheckBox Content="Horizontal" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.Horizontal}}">
            </CheckBox>
            <CheckBox Content="All" Margin="1"
                      IsChecked="{Binding Path=MaxLengthFlags, Converter={StaticResource MagLengthFlagsEnumConverter}, ConverterParameter={x:Static core:MaxLengthFlags.All}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="StartStateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=MaxLengthStartState, Converter={StaticResource StartStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="EndStateControlTemplateKey">
        <StackPanel Margin="5,2,5,2">
            <CheckBox Content="Default" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Default}}">
            </CheckBox>
            <CheckBox Content="Visible" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Visible}}">
            </CheckBox>
            <CheckBox Content="Printable" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Printable}}">
            </CheckBox>
            <CheckBox Content="Locked" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Locked}}">
            </CheckBox>
            <CheckBox Content="Connector" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Connector}}">
            </CheckBox>
            <CheckBox Content="None" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.None}}">
            </CheckBox>
            <CheckBox Content="Standalone" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Standalone}}">
            </CheckBox>
            <CheckBox Content="Input" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Input}}">
            </CheckBox>
            <CheckBox Content="Output" Margin="1"
                      IsChecked="{Binding Path=MaxLengthEndState, Converter={StaticResource EndStateFlagsEnumConverter}, ConverterParameter={x:Static core:ShapeState.Output}}">
            </CheckBox>
        </StackPanel>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:ArgbColor}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <Rectangle 
                Fill="{StaticResource CheckerBoard}"
                Grid.Row="0" 
                Grid.Column="0" 
                Grid.ColumnSpan="3" 
                Margin="5,2,5,2"
                Height="20">
            </Rectangle>
            <Rectangle 
                Grid.Row="0" 
                Grid.Column="0" 
                Grid.ColumnSpan="3" 
                Margin="5,2,5,2"
                Height="20">
                <Rectangle.Fill>
                    <MultiBinding Converter="{StaticResource ArgbColorToBrushMultiConverter}">
                        <Binding Path="DataContext.A" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.R" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.G" RelativeSource="{RelativeSource Self}"/>
                        <Binding Path="DataContext.B" RelativeSource="{RelativeSource Self}"/>
                    </MultiBinding>
                </Rectangle.Fill>
            </Rectangle>
            <TextBlock Text="A" 
                       Margin="5,2,5,2" 
                       Grid.Row="1"
                       Grid.Column="0" 
                       TextAlignment="Center" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="R" 
                       Margin="5,2,5,2" 
                       Grid.Row="2" 
                       Grid.Column="0" 
                       TextAlignment="Center" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="G" 
                       Margin="5,2,5,2" 
                       Grid.Row="3" 
                       Grid.Column="0" 
                       TextAlignment="Center" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="B" 
                       Margin="5,2,5,2" 
                       Grid.Row="4" 
                       Grid.Column="0" 
                       TextAlignment="Center" 
                       VerticalAlignment="Center">
            </TextBlock>
            <Slider Value="{Binding A}" 
                    Minimum="0" 
                    Maximum="255" 
                    TickFrequency="1" 
                    IsSnapToTickEnabled="True" 
                    Grid.Row="1" 
                    Grid.Column="1" 
                    Margin="5,2,5,2">
            </Slider>
            <Slider Value="{Binding R}" 
                    Minimum="0" 
                    Maximum="255" 
                    TickFrequency="1" 
                    IsSnapToTickEnabled="True" 
                    Grid.Row="2" 
                    Grid.Column="1" 
                    Margin="5,2,5,2">
            </Slider>
            <Slider Value="{Binding G}" 
                    Minimum="0" 
                    Maximum="255" 
                    TickFrequency="1" 
                    IsSnapToTickEnabled="True" 
                    Grid.Row="3" 
                    Grid.Column="1" 
                    Margin="5,2,5,2">
            </Slider>
            <Slider Value="{Binding B}" 
                    Minimum="0" 
                    Maximum="255" 
                    TickFrequency="1" 
                    IsSnapToTickEnabled="True" 
                    Grid.Row="4" 
                    Grid.Column="1" 
                    Margin="5,2,5,2">
            </Slider>
            <TextBox Text="{Binding A, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="1" 
                     Grid.Column="2" 
                     TextAlignment="Center" 
                     VerticalAlignment="Center">
            </TextBox>
            <TextBox Text="{Binding R, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="2" 
                     Grid.Column="2" 
                     TextAlignment="Center" 
                     VerticalAlignment="Center">
            </TextBox>
            <TextBox Text="{Binding G, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="3" 
                     Grid.Column="2" 
                     TextAlignment="Center" 
                     VerticalAlignment="Center">
            </TextBox>
            <TextBox Text="{Binding B, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="4" 
                     Grid.Column="2" 
                     TextAlignment="Center" 
                     VerticalAlignment="Center">
            </TextBox>
        </Grid>
    </DataTemplate>
    <ControlTemplate x:Key="BaseStyleControlTemplateKey">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Name" 
                           Margin="5,2,5,2" 
                           Grid.Row="0" 
                           Grid.Column="0" 
                           TextAlignment="Left" 
                           VerticalAlignment="Center">
                </TextBlock>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         Grid.Row="0" 
                         Grid.Column="1" 
                         TextAlignment="Left" 
                         VerticalAlignment="Center">
                </TextBox>
            </Grid>
            <Expander Header="Stroke" IsExpanded="False">
                <ContentControl Content="{Binding Stroke}"/>
            </Expander>
            <Expander Header="Fill" IsExpanded="False">
                <ContentControl Content="{Binding Fill}"/>
            </Expander>
            <Expander Header="Thickness" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <Slider Value="{Binding Thickness}" 
                            Minimum="0" 
                            Maximum="50" 
                            TickFrequency="0.1" 
                            SmallChange="0.1" 
                            LargeChange="1" 
                            IsSnapToTickEnabled="True" 
                            Grid.Row="0" 
                            Grid.Column="0" 
                            Margin="5,2,5,2">
                    </Slider>
                    <TextBox Text="{Binding Thickness, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                             BorderBrush="{x:Null}"
                             Margin="5,2,5,2"
                             Grid.Row="0" 
                             Grid.Column="1" 
                             TextAlignment="Center" 
                             VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="Cap" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Line Cap" 
                               Margin="5,2,5,2" 
                               Grid.Row="0"
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <ComboBox ItemsSource="{Binding Source={StaticResource ResourceKey=LineCapValues}}" 
                              SelectedItem="{Binding LineCap}" 
                              Grid.Row="0" 
                              Grid.Column="1" 
                              Grid.ColumnSpan="2"
                              Margin="5,2,5,2">
                    </ComboBox>
                </Grid>
            </Expander>
            <Expander Header="Dash" IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Dashes" 
                               Margin="5,2,5,2" 
                               Grid.Row="0" 
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="Dash Offset" 
                               Margin="5,2,5,2" 
                               Grid.Row="1" 
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBox Text="{Binding Dashes, Converter={StaticResource DoubleToStringConverter}}" 
                             BorderBrush="{x:Null}" 
                             Margin="5,2,5,2"
                             Grid.Row="0" 
                             Grid.Column="1" 
                             Grid.ColumnSpan="2"
                             TextAlignment="Left" 
                             VerticalAlignment="Center">
                    </TextBox>
                    <Slider Value="{Binding DashOffset}" 
                            Minimum="0" 
                            Maximum="15" 
                            TickFrequency="0.1" 
                            SmallChange="0.1"
                            LargeChange="1"
                            IsSnapToTickEnabled="True" 
                            Grid.Row="1" 
                            Grid.Column="1" 
                            Margin="5,2,5,2">
                    </Slider>
                    <TextBox Text="{Binding DashOffset, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                             BorderBrush="{x:Null}" 
                             Margin="5,2,5,2"
                             Grid.Row="1" 
                             Grid.Column="2" 
                             TextAlignment="Center" 
                             VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </Expander>
        </StackPanel>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:ArrowStyle}">
        <TabControl>
            <TabItem Header="Arrow">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Arrow Type" 
                               Margin="5,2,5,2" 
                               Grid.Row="0"
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="IsStroked" 
                               Margin="5,2,5,2" 
                               Grid.Row="1"
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="IsFilled" 
                               Margin="5,2,5,2" 
                               Grid.Row="2"
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="RadiusX" 
                               Margin="5,2,5,2" 
                               Grid.Row="3" 
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="RadiusY" 
                               Margin="5,2,5,2" 
                               Grid.Row="4" 
                               Grid.Column="0" 
                               TextAlignment="Left" 
                               VerticalAlignment="Center">
                    </TextBlock>
                    <ComboBox ItemsSource="{Binding Source={StaticResource ResourceKey=ArrowTypeValues}}" 
                              SelectedItem="{Binding ArrowType}" 
                              Grid.Row="0" 
                              Grid.Column="1" 
                              Grid.ColumnSpan="2"
                              Margin="5,2,5,2">
                    </ComboBox>
                    <CheckBox Content=""
                              IsChecked="{Binding IsStroked}"
                              Grid.Row="1" 
                              Grid.Column="1" 
                              Grid.ColumnSpan="2"
                              Margin="5,2,5,2">
                    </CheckBox>
                    <CheckBox Content=""
                              IsChecked="{Binding IsFilled}"
                              Grid.Row="2" 
                              Grid.Column="1" 
                              Grid.ColumnSpan="2"
                              Margin="5,2,5,2">
                    </CheckBox>
                    <Slider Value="{Binding RadiusX}" 
                            Minimum="0" 
                            Maximum="15" 
                            TickFrequency="0.1" 
                            SmallChange="0.1"
                            LargeChange="1"
                            IsSnapToTickEnabled="True" 
                            Grid.Row="3" 
                            Grid.Column="1" 
                            Margin="5,2,5,2">
                    </Slider>
                    <Slider Value="{Binding RadiusY}" 
                            Minimum="0" 
                            Maximum="15" 
                            TickFrequency="0.1" 
                            SmallChange="0.1"
                            LargeChange="1"
                            IsSnapToTickEnabled="True" 
                            Grid.Row="4" 
                            Grid.Column="1" 
                            Margin="5,2,5,2">
                    </Slider>
                    <TextBox Text="{Binding RadiusX, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                             BorderBrush="{x:Null}" 
                             Margin="5,2,5,2"
                             Grid.Row="3" 
                             Grid.Column="2" 
                             TextAlignment="Center" 
                             VerticalAlignment="Center">
                    </TextBox>
                    <TextBox Text="{Binding RadiusY, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                             BorderBrush="{x:Null}" 
                             Margin="5,2,5,2"
                             Grid.Row="4" 
                             Grid.Column="2" 
                             TextAlignment="Center" 
                             VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </TabItem>
            <TabItem Header="Style">
                <Control Template="{StaticResource BaseStyleControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:TextStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="FontName" 
                       Margin="5,2,5,2" 
                       Grid.Row="0"
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="FontFile" 
                       Margin="5,2,5,2" 
                       Grid.Row="1"
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="FontSize" 
                       Margin="5,2,5,2" 
                       Grid.Row="2" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="FontStyle" 
                       Margin="5,2,5,2" 
                       Grid.Row="3" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="HAlignment" 
                       Margin="5,2,5,2" 
                       Grid.Row="4" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <TextBlock Text="VAlignment" 
                       Margin="5,2,5,2" 
                       Grid.Row="5" 
                       Grid.Column="0" 
                       TextAlignment="Left" 
                       VerticalAlignment="Center">
            </TextBlock>
            <Slider Value="{Binding FontSize}" 
                    Minimum="0" 
                    Maximum="72" 
                    TickFrequency="1" 
                    IsSnapToTickEnabled="True" 
                    Grid.Row="2" 
                    Grid.Column="1" 
                    Margin="5,2,5,2">
            </Slider>
            <TextBox Text="{Binding FontName, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="0" 
                     Grid.Column="1" 
                     Grid.ColumnSpan="2"
                     TextAlignment="Left" 
                     VerticalAlignment="Center">
            </TextBox>
            <TextBox Text="{Binding FontFile, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="1" 
                     Grid.Column="1" 
                     Grid.ColumnSpan="2"
                     TextAlignment="Left" 
                     VerticalAlignment="Center">
            </TextBox>
            <TextBox Text="{Binding FontSize, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                     BorderBrush="{x:Null}" 
                     Margin="5,2,5,2"
                     Grid.Row="2" 
                     Grid.Column="2" 
                     TextAlignment="Center" 
                     VerticalAlignment="Center">
            </TextBox>
            <Control Template="{StaticResource FontStyleControlTemplateKey}"
                     Grid.Row="3" 
                     Grid.Column="1"
                     Grid.ColumnSpan="2">
            </Control>
            <ComboBox ItemsSource="{Binding Source={StaticResource ResourceKey=TextHAlignmentValues}}" 
                      SelectedItem="{Binding TextHAlignment}" 
                      Grid.Row="4" 
                      Grid.Column="1" 
                      Grid.ColumnSpan="2"
                      Margin="5,2,5,2">
            </ComboBox>
            <ComboBox ItemsSource="{Binding Source={StaticResource ResourceKey=TextVAlignmentValues}}" 
                      SelectedItem="{Binding TextVAlignment}" 
                      Grid.Row="5" 
                      Grid.Column="1" 
                      Grid.ColumnSpan="2"
                      Margin="5,2,5,2">
            </ComboBox>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:LineStyle}">
        <TabControl>
            <TabItem Header="Flags">
                <Control Template="{StaticResource MaxLengthControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Length">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <Slider
                        Value="{Binding MaxLength}" 
                        Minimum="0" 
                        Maximum="30" 
                        TickFrequency="0.1" 
                        SmallChange="0.1"
                        LargeChange="1"
                        IsSnapToTickEnabled="True" 
                        Grid.Column="0" 
                        Margin="5,2,5,2">
                    </Slider>
                    <TextBox
                        Text="{Binding MaxLength, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}" 
                        Margin="5,2,5,2"
                        Grid.Column="1" 
                        TextAlignment="Center" 
                        VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </TabItem>
            <TabItem Header="Start">
                <Control Template="{StaticResource StartStateControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="End">
                <Control Template="{StaticResource EndStateControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:ShapeStyle}">
        <TabControl>
            <TabItem Header="Base">
                <Control Template="{StaticResource BaseStyleControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Text">
                <ContentControl Content="{Binding TextStyle}"/>
            </TabItem>
            <TabItem Header="Line">
                <StackPanel>
                    <Expander Header="Line Start Arrow" IsExpanded="False">
                        <ContentControl Content="{Binding StartArrowStyle}"/>
                    </Expander>
                    <Expander Header="Line End Arrow" IsExpanded="False">
                        <ContentControl Content="{Binding EndArrowStyle}"/>
                    </Expander>
                    <Expander Header="Line MaxLength" IsExpanded="False">
                        <ContentControl Content="{Binding LineStyle}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <!-- code -->
    <ControlTemplate x:Key="CodeControlTemplateKey">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBlock 
                    Text="IsExecutable" 
                    Margin="5,2,5,2" 
                    Grid.Row="0"
                    Grid.Column="0" 
                    TextAlignment="Left" 
                    VerticalAlignment="Center">
                </TextBlock>
                <CheckBox 
                    Content=""
                    IsChecked="{Binding Code.IsExecutable}"
                    Grid.Row="0" 
                    Grid.Column="1" 
                    Grid.ColumnSpan="2"
                    Margin="5,2,5,2">
                </CheckBox>
            </Grid>
            <TabControl>
                <TabItem Header="Definitions">
                    <TextBox 
                        Text="{Binding Code.Definitions, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         TextAlignment="Left" 
                         VerticalAlignment="Center"
                         AcceptsReturn="True"
                         AcceptsTab="True">
                    </TextBox>
                </TabItem>
                <TabItem Header="Initialization">
                    <TextBox 
                        Text="{Binding Code.Initialization, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         TextAlignment="Left" 
                         VerticalAlignment="Center"
                         AcceptsReturn="True"
                         AcceptsTab="True">
                    </TextBox>
                </TabItem>
                <TabItem Header="Script">
                    <TextBox 
                        Text="{Binding Code.Script, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         TextAlignment="Left" 
                         VerticalAlignment="Center"
                         AcceptsReturn="True"
                         AcceptsTab="True">
                    </TextBox>
                </TabItem>
            </TabControl>
        </StackPanel>
    </ControlTemplate>
    <!-- data -->
    <ControlTemplate x:Key="BindingsMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem Command="{Binding DataContext.Commands.AddBindingCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                      CommandParameter="{Binding}" 
                      Header="+"/>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="BindingsControlTemplateKey">
         <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource BindingsMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <Grid Height="Auto" VerticalAlignment="Top" Grid.Row="1">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Bindings.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="70"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Property"/>
                <TextBlock Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Path"/>
            </Grid>
            <ItemsControl x:Name="bindingsItemsControls"
                          VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2"
                          ItemsSource="{Binding Bindings, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Property, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <TextBox Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Path, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <Button Grid.Column="2" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Content="-" 
                                    Command="{Binding DataContext.Commands.RemoveBindingCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ShapeBindingParameterConverter}">
                                        <Binding Path="DataContext" ElementName="bindingsItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="PropertiesMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem Command="{Binding DataContext.Commands.AddPropertyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                      CommandParameter="{Binding}" 
                      Header="+"/>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="PropertiesControlTemplateKey">
         <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource PropertiesMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <Grid Height="Auto" VerticalAlignment="Top" Grid.Row="1">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Properties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="70"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Name"/>
                <TextBlock Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Value"/>
            </Grid>
            <ItemsControl x:Name="propertiesItemsControls"
                          VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2"
                          ItemsSource="{Binding Properties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <TextBox Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <Button Grid.Column="2" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Content="-" 
                                    Command="{Binding DataContext.Commands.RemovePropertyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ShapePropertyParameterConverter}">
                                        <Binding Path="DataContext" ElementName="propertiesItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="ShapesPropertiesControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid Height="Auto" VerticalAlignment="Top" Grid.Row="0">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ShapesProperties.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="70"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Name"/>
                <TextBlock Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Value"/>
            </Grid>
            <ItemsControl VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="1"
                          ItemsSource="{Binding ShapesProperties, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <TextBox Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="RecordMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem Command="{Binding DataContext.Commands.ResetRecordCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                      CommandParameter="{Binding}" 
                      Header="X"/>
        </Menu>
    </ControlTemplate>
    <DataTemplate DataType="{x:Type core:Record}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="60*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <GridSplitter 
                Grid.Column="1" 
                Grid.Row="0"
                Grid.RowSpan="2"
                Width="10" 
                Background="Transparent" 
                ResizeBehavior="PreviousAndNext" 
                ShowsPreview="True">
            </GridSplitter>
            <TextBlock Grid.Column="0" Grid.Row="0" Margin="5,2,0,2" VerticalAlignment="Center" Text="Name">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock Grid.Column="2" Grid.Row="0" Margin="0,2,5,2" VerticalAlignment="Center" Text="Value">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <ItemsControl VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" 
                          Grid.Row="1" Grid.Column="0"
                          ItemsSource="{Binding Columns, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="5,2,0,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" 
                          Grid.Row="1" Grid.Column="2"
                          ItemsSource="{Binding Values, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="0,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Content, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </DataTemplate>
    <ControlTemplate x:Key="RecordControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource RecordMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <ContentControl Content="{Binding Record}" Grid.Row="1"/>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="ColumnsMenu">
        <Menu Background="Transparent" HorizontalAlignment="Right">
            <MenuItem Command="{Binding DataContext.Commands.AddColumnCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                      CommandParameter="{Binding}" 
                      Header="+"/>
        </Menu>
    </ControlTemplate>
    <ControlTemplate x:Key="ColumnsControlTemplateKey">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Control Template="{StaticResource ColumnsMenu}" Grid.Row="0" Margin="2,0,2,0"/>
            <Grid Height="Auto" VerticalAlignment="Top" Grid.Row="1">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Columns.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="30"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Text="Name"/>
            </Grid>
            <ItemsControl x:Name="columnsItemsControls"
                          VerticalContentAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="2"
                          ItemsSource="{Binding Columns, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="Auto" VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox Grid.Column="0" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" 
                                     Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            <Button Grid.Column="1" Grid.Row="0" Margin="5,2,5,2" VerticalAlignment="Center" Content="-" 
                                    Command="{Binding DataContext.Commands.RemoveColumnCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
                                <Button.CommandParameter>
                                    <MultiBinding Converter="{StaticResource ColumnParameterConverter}">
                                        <Binding Path="DataContext" ElementName="columnsItemsControls"/>
                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                    </MultiBinding>
                                </Button.CommandParameter>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ControlTemplate>
    <ControlTemplate x:Key="DatabaseControlTemplateKey">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Expander Header="Columns" IsExpanded="True">
                <Control Template="{StaticResource ColumnsControlTemplateKey}"/>
            </Expander>
            <Expander Header="Current Record" IsExpanded="False">
                <ContentControl Content="{Binding CurrentRecord}"/>
            </Expander>
        </StackPanel>
    </ControlTemplate>
    <ControlTemplate x:Key="DataControlTemplate">
        <TabControl>
            <TabItem Header="Record">
                <Control Template="{StaticResource RecordControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Bindings">
                <Control Template="{StaticResource BindingsControlTemplateKey}"/>
            </TabItem>
            <TabItem Header="Properties">
                <Control Template="{StaticResource PropertiesControlTemplateKey}"/>
            </TabItem>
        </TabControl>
    </ControlTemplate>
    <!-- shapes -->
    <DataTemplate DataType="{x:Type core:XPoint}">
        <TabControl>
            <TabItem Header="Point">
                <StackPanel>
                    <Control Template="{StaticResource NameControlTemplateKey}"/>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="X" 
                                   Margin="5,2,5,2" 
                                   Grid.Row="0" 
                                   Grid.Column="0" 
                                   TextAlignment="Left" 
                                   VerticalAlignment="Center">
                        </TextBlock>
                        <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                 BorderBrush="{x:Null}" 
                                 Margin="5,2,5,2"
                                 Grid.Row="0" 
                                 Grid.Column="1" 
                                 TextAlignment="Left" 
                                 VerticalAlignment="Center">
                        </TextBox>
                    </Grid>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Y" 
                                   Margin="5,2,5,2" 
                                   Grid.Row="0" 
                                   Grid.Column="0" 
                                   TextAlignment="Left" 
                                   VerticalAlignment="Center">
                        </TextBlock>
                        <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                 BorderBrush="{x:Null}" 
                                 Margin="5,2,5,2"
                                 Grid.Row="0" 
                                 Grid.Column="1" 
                                 TextAlignment="Left" 
                                 VerticalAlignment="Center">
                        </TextBox>
                    </Grid>
                    <Expander Header="State">
                        <Control Template="{StaticResource StateControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Code">
                        <Control Template="{StaticResource CodeControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Data">
                        <Control Template="{StaticResource DataControlTemplate}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
            <TabItem Header="Shape">
                <ContentControl Content="{Binding Shape}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XLine}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Expander Header="Start">
                <ContentControl Content="{Binding Start}"/>
            </Expander>
            <Expander Header="End">
                <ContentControl Content="{Binding End}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XRectangle}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XEllipse}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XArc}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="Point4">
                <ContentControl Content="{Binding Point4}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XBezier}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="Point4">
                <ContentControl Content="{Binding Point4}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XQBezier}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Point1">
                <ContentControl Content="{Binding Point1}"/>
            </Expander>
            <Expander Header="Point2">
                <ContentControl Content="{Binding Point2}"/>
            </Expander>
            <Expander Header="Point3">
                <ContentControl Content="{Binding Point3}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
    </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XText}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XImage}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Control Template="{StaticResource TextControlTemplateKey}"/>
            <Expander Header="Path">
                <Grid>
                    <TextBox Text="{Binding Path, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                BorderBrush="{x:Null}" 
                                Margin="5,2,5,2"
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="TopLeft">
                <ContentControl Content="{Binding TopLeft}"/>
            </Expander>
            <Expander Header="BottomRight">
                <ContentControl Content="{Binding BottomRight}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XGroup}">
        <TabControl>
            <TabItem Header="Group">
                <StackPanel>
                    <Control Template="{StaticResource NameControlTemplateKey}"/>
                    <Expander Header="Properties">
                        <Control Template="{StaticResource ShapesPropertiesControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="State">
                        <Control Template="{StaticResource StateControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Code">
                        <Control Template="{StaticResource CodeControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Data">
                        <Control Template="{StaticResource DataControlTemplate}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
            <TabItem Header="Shapes">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListBox 
                        x:Name="shapesListBox"
                        ItemsSource="{Binding Shapes}"
                        BorderBrush="{x:Null}"
                        Grid.Row="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="0,5,0,5"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <ContentControl 
                        Content="{Binding ElementName=shapesListBox, Path=SelectedItem}" 
                        Grid.Row="1" Margin="5,2,5,2">
                    </ContentControl>
                </Grid>
            </TabItem>
            <TabItem Header="Connectors">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListBox 
                        x:Name="connectorsListBox"
                        ItemsSource="{Binding Connectors}"
                        BorderBrush="{x:Null}"
                        Grid.Row="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="0,5,0,5"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <ContentControl 
                        Content="{Binding ElementName=connectorsListBox, Path=SelectedItem}" 
                        Grid.Row="1" Margin="5,2,5,2">
                    </ContentControl>
                </Grid>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XReference}">
        <TabControl>
            <TabItem Header="Reference">
                <StackPanel>
                    <Control Template="{StaticResource NameControlTemplateKey}"/>
                    <Expander Header="Properties">
                        <Control Template="{StaticResource ShapesPropertiesControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="State">
                        <Control Template="{StaticResource StateControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Code">
                        <Control Template="{StaticResource CodeControlTemplateKey}"/>
                    </Expander>
                    <Expander Header="Data">
                        <Control Template="{StaticResource DataControlTemplate}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
            <TabItem Header="Origin">
                <ContentControl Content="{Binding Origin}"/>
            </TabItem>
            <TabItem Header="Shape">
                <ContentControl Content="{Binding Shape}"/>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:XPath}">
        <StackPanel>
            <Control Template="{StaticResource NameControlTemplateKey}"/>
            <Control Template="{StaticResource StyleControlTemplateKey}"/>
            <Control Template="{StaticResource IsStrokedControlTemplateKey}"/>
            <Control Template="{StaticResource IsFilledControlTemplateKey}"/>
            <Expander Header="Source">
                <Grid>
                    <TextBox Text="{Binding Source, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                AcceptsReturn="True"
                                AcceptsTab="True"
                                BorderBrush="{x:Null}" 
                                Margin="5,2,5,2"
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="Geometry">
                <ContentControl Content="{Binding Geometry}"/>
            </Expander>
            <Expander Header="State">
                <Control Template="{StaticResource StateControlTemplateKey}"/>
            </Expander>
            <Expander Header="Code">
                <Control Template="{StaticResource CodeControlTemplateKey}"/>
            </Expander>
            <Expander Header="Data">
                <Control Template="{StaticResource DataControlTemplate}"/>
            </Expander>
            <Expander Header="Style">
                <ContentControl Content="{Binding Style}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <!-- project -->
    <ContextMenu x:Key="ContainerContextMenu" 
                 DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem Header="Te_mplate" 
                  Tag="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                  DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" ItemsSource="{Binding Editor.Project.Templates}">
            <MenuItem.ItemContainerStyle>
                <Style TargetType="MenuItem">
                    <Setter Property="Header" Value="{Binding Name}"/>
                    <Setter Property="Command" Value="{Binding Path=Tag.Commands.ApplyTemplateCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type MenuItem}}, FallbackValue={x:Null}}"/>
                    <Setter Property="CommandParameter" Value="{Binding}"/>
                    <Setter Property="IsCheckable" Value="True"/>
                    <Setter Property="IsChecked" Value="False"/>
                    <Style.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <MultiBinding Converter="{StaticResource ObjectEqualityConverter}">
                                    <Binding Path="Tag.Editor.Project.CurrentContainer.Template" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type MenuItem}}"/>
                                    <Binding Path="DataContext" RelativeSource="{RelativeSource Self}"/>
                                </MultiBinding>
                            </DataTrigger.Binding>
                            <Setter Property="IsChecked" Value="True"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </MenuItem.ItemContainerStyle>
        </MenuItem>
        <Separator/>
        <MenuItem Header="Insert Container Bef_ore" InputGestureText="" Command="{Binding DataContext.Commands.InsertContainerBeforeCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="Insert Container Aft_er" InputGestureText="" Command="{Binding DataContext.Commands.InsertContainerAfterCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="Cu_t" InputGestureText="Ctrl+X" Command="{Binding DataContext.Commands.CutCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="_Copy" InputGestureText="Ctrl+C" Command="{Binding DataContext.Commands.CopyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="_Paste" InputGestureText="Ctrl+V" Command="{Binding DataContext.Commands.PasteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="_Delete" InputGestureText="Del" Command="{Binding DataContext.Commands.DeleteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="E_xport" InputGestureText="Ctrl+E" Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
    </ContextMenu>
    <ContextMenu x:Key="DocumentContextMenu" 
                 DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem Header="_Add Container" InputGestureText="Ctrl+N" Command="{Binding DataContext.Commands.AddContainerCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="Insert Document Bef_ore" InputGestureText="" Command="{Binding DataContext.Commands.InsertDocumentBeforeCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="Insert Document Aft_er" InputGestureText="" Command="{Binding DataContext.Commands.InsertDocumentAfterCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="Cu_t" InputGestureText="Ctrl+X" Command="{Binding DataContext.Commands.CutCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="_Copy" InputGestureText="Ctrl+C" Command="{Binding DataContext.Commands.CopyCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <MenuItem Header="_Paste" InputGestureText="Ctrl+V" Command="{Binding DataContext.Commands.PasteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="_Delete" InputGestureText="Del" Command="{Binding DataContext.Commands.DeleteCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="E_xport" InputGestureText="Ctrl+E" Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
    </ContextMenu>
    <ContextMenu x:Key="PojectContextMenu" 
                 DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem Header="_Add Document" InputGestureText="Ctrl+N" Command="{Binding DataContext.Commands.AddDocumentCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
        <Separator/>
        <MenuItem Header="E_xport" InputGestureText="Ctrl+E" Command="{Binding DataContext.Commands.ExportCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
    </ContextMenu>
    <DataTemplate DataType="{x:Type core:Options}">
        <TabControl>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderGeneral}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapToGrid}" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapX}" 
                        Margin="5,2,5,2" 
                        Grid.Row="1" 
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsSnapY}" 
                        Margin="5,2,5,2" 
                        Grid.Row="2" 
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsHitTreshold}" 
                        Margin="5,2,5,2" 
                        Grid.Row="3" 
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsMoveMode}" 
                        Margin="5,2,5,2" 
                        Grid.Row="4"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsTryToConnect}" 
                        Margin="5,2,5,2" 
                        Grid.Row="5"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsCycleResolution}" 
                        Margin="5,2,5,2" 
                        Grid.Row="6"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding SnapToGrid}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipSnapToGrid}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptSnapToGrid}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <TextBox 
                        Text="{Binding SnapX, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}" 
                        Margin="5,2,5,2"
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipSnapX}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptSnapX}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                    <TextBox 
                        Text="{Binding SnapY, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}" 
                        Margin="5,2,5,2"
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipSnapY}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptSnapY}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                    <TextBox 
                        Text="{Binding HitTreshold, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}" 
                        Margin="5,2,5,2"
                        Grid.Row="3" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipHitTreshold}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptHitTreshold}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=MoveModeValues}}" 
                        SelectedItem="{Binding MoveMode}" 
                        Margin="5,2,5,2" 
                        Grid.Row="4" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                        <ComboBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipMoveMode}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptMoveMode}"/>
                            </StackPanel>
                        </ComboBox.ToolTip>
                    </ComboBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding TryToConnect}"
                        Grid.Row="5" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipTryToConnect}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptTryToConnect}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <TextBox 
                        Text="{Binding CycleResolution, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                        BorderBrush="{x:Null}" 
                        Margin="5,2,5,2"
                        Grid.Row="6" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipCycleResolution}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptCycleResolution}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                </Grid>
            </TabItem>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderDefaults}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsStroked}" 
                        Margin="5,2,5,2" 
                        Grid.Row="0"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsFilled}" 
                        Margin="5,2,5,2" 
                        Grid.Row="1"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsClosed}" 
                        Margin="5,2,5,2" 
                        Grid.Row="2"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultIsSmoothJoin}" 
                        Margin="5,2,5,2" 
                        Grid.Row="3"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock 
                        Text="{x:Static p:Resources.OptionsDefaultFillRule}" 
                        Margin="5,2,5,2" 
                        Grid.Row="4"
                        Grid.Column="0" 
                        TextAlignment="Left" 
                        VerticalAlignment="Center">
                    </TextBlock>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsStroked}"
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipDefaultIsStroked}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptDefaultIsStroked}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsFilled}"
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipDefaultIsFilled}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptDefaultIsFilled}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsClosed}"
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipDefaultIsClosed}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptDefaultIsClosed}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <CheckBox 
                        Content=""
                        IsChecked="{Binding DefaultIsSmoothJoin}"
                        Grid.Row="3" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2"
                        Margin="5,2,5,2">
                        <CheckBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipDefaultIsSmoothJoin}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptDefaultIsSmoothJoin}"/>
                            </StackPanel>
                        </CheckBox.ToolTip>
                    </CheckBox>
                    <ComboBox 
                        ItemsSource="{Binding Source={StaticResource ResourceKey=XFillRuleValues}}" 
                        SelectedItem="{Binding DefaultFillRule}" 
                        Margin="5,2,5,2" 
                        Grid.Row="4" 
                        Grid.Column="1" 
                        Grid.ColumnSpan="2">
                        <ComboBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipDefaultFillRule}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptDefaultFillRule}"/>
                            </StackPanel>
                        </ComboBox.ToolTip>
                    </ComboBox>
                </Grid>
            </TabItem>
            <TabItem Header="{x:Static p:Resources.OptionsHeaderAdvanced}">
                <StackPanel>
                    <Expander Header="{x:Static p:Resources.OptionsPointShape}">
                        <Expander.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipPointShape}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptPointShape}"/>
                            </StackPanel>
                        </Expander.ToolTip>
                        <ContentControl Content="{Binding PointShape}"/>
                    </Expander>
                    <Expander Header="{x:Static p:Resources.OptionsSelectionStyle}">
                        <Expander.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipSelectionStyle}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptSelectionStyle}"/>
                            </StackPanel>
                        </Expander.ToolTip>
                        <ContentControl Content="{Binding SelectionStyle}"/>
                    </Expander>
                    <Expander Header="{x:Static p:Resources.OptionsHelperStyle}">
                        <Expander.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.OptionsTooltipHelperStyle}"/>
                                <TextBlock Text="{x:Static p:Resources.OptionsTooltipScriptHelperStyle}"/>
                            </StackPanel>
                        </Expander.ToolTip>
                        <ContentControl Content="{Binding HelperStyle}"/>
                    </Expander>
                </StackPanel>
            </TabItem>
        </TabControl>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Project}">
        <StackPanel>
            <Expander Header="{x:Static p:Resources.ProjectOptions}" IsExpanded="False">
                <Expander.ToolTip>
                    <StackPanel>
                        <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ProjectTooltipOptions}"/>
                        <TextBlock Text="{x:Static p:Resources.ProjectTooltipScriptOptions}"/>
                    </StackPanel>
                </Expander.ToolTip>
                <ContentControl Content="{Binding Options}"/>
            </Expander>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="40"/>
                </Grid.ColumnDefinitions>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         Grid.Row="0" 
                         Grid.Column="0" 
                         Grid.ColumnSpan="2"
                         TextAlignment="Left" 
                         VerticalAlignment="Center">
                    <TextBox.ToolTip>
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ProjectTooltipName}"/>
                            <TextBlock Text="{x:Static p:Resources.ProjectTooltipScriptName}"/>
                        </StackPanel>
                    </TextBox.ToolTip>
                </TextBox>
            </Grid>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Document}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{x:Static p:Resources.DocumentName}" 
                           Margin="5,2,5,2" 
                           Grid.Row="0" 
                           Grid.Column="0" 
                           TextAlignment="Left" 
                           VerticalAlignment="Center">
                </TextBlock>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         Grid.Row="0" 
                         Grid.Column="1" 
                         TextAlignment="Left" 
                         VerticalAlignment="Center">
                    <TextBox.ToolTip>
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.DocumentTooltipName}"/>
                            <TextBlock Text="{x:Static p:Resources.DocumentTooltipScriptName}"/>
                        </StackPanel>
                    </TextBox.ToolTip>
                </TextBox>
            </Grid>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:Container}">
        <StackPanel>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{x:Static p:Resources.ContainerName}" 
                           Margin="5,2,5,2" 
                           Grid.Row="0" 
                           Grid.Column="0" 
                           TextAlignment="Left" 
                           VerticalAlignment="Center">
                </TextBlock>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                         BorderBrush="{x:Null}" 
                         Margin="5,2,5,2"
                         Grid.Row="0" 
                         Grid.Column="1" 
                         TextAlignment="Left" 
                         VerticalAlignment="Center">
                    <TextBox.ToolTip>
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipName}"/>
                            <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptName}"/>
                        </StackPanel>
                    </TextBox.ToolTip>
                </TextBox>
            </Grid>
            <Expander Header="{x:Static p:Resources.ContainerProperties}">
                <Expander.ToolTip>
                    <StackPanel>
                        <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipProperties}"/>
                        <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptProperties}"/>
                    </StackPanel>
                </Expander.ToolTip>
                <Control Template="{StaticResource PropertiesControlTemplateKey}"/>
            </Expander>
            <Expander Header="{x:Static p:Resources.ContainerTemplate}">
                <Grid>
                    <ComboBox ItemsSource="{Binding Path=DataContext.Editor.Project.Templates, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" 
                                SelectedItem="{Binding Path=DataContext.Template, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type StackPanel}}}" 
                                Margin="5,2,5,2">
                        <ComboBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipTemplate}"/>
                                <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptTemplate}"/>
                            </StackPanel>
                        </ComboBox.ToolTip>
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </Grid>
            </Expander>
            <Expander Header="{x:Static p:Resources.ContainerSize}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{x:Static p:Resources.ContainerWidth}" 
                                Margin="5,2,5,2" 
                                Grid.Row="0" 
                                Grid.Column="0" 
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                    </TextBlock>
                    <TextBlock Text="{x:Static p:Resources.ContainerHeight}" 
                                Margin="5,2,5,2" 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                    </TextBlock>
                    <TextBox Text="{Binding Width, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                BorderBrush="{x:Null}"
                                Margin="5,2,5,2"
                                Grid.Row="0" 
                                Grid.Column="1" 
                                Grid.ColumnSpan="2"
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipWidth}"/>
                                <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptWidth}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                    <TextBox Text="{Binding Height, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                                BorderBrush="{x:Null}" 
                                Margin="5,2,5,2"
                                Grid.Row="1" 
                                Grid.Column="1" 
                                Grid.ColumnSpan="2"
                                TextAlignment="Left" 
                                VerticalAlignment="Center">
                        <TextBox.ToolTip>
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipHeight}"/>
                                <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptHeight}"/>
                            </StackPanel>
                        </TextBox.ToolTip>
                    </TextBox>
                </Grid>
            </Expander>
            <Expander Header="{x:Static p:Resources.ContainerBackground}">
                <Expander.ToolTip>
                    <StackPanel>
                        <TextBlock FontWeight="Bold" Text="{x:Static p:Resources.ContainerTooltipBackground}"/>
                        <TextBlock Text="{x:Static p:Resources.ContainerTooltipScriptBackground}"/>
                    </StackPanel>
                </Expander.ToolTip>
                <ContentControl Content="{Binding Background}"/>
            </Expander>
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:StyleLibrary}">
        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                 BorderBrush="{x:Null}" 
                 TextAlignment="Left" 
                 VerticalAlignment="Center">
        </TextBox>
    </DataTemplate>
    <DataTemplate DataType="{x:Type core:GroupLibrary}">
        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, Delay=500}" 
                 BorderBrush="{x:Null}" 
                 TextAlignment="Left" 
                 VerticalAlignment="Center">
        </TextBox>
    </DataTemplate>
    <ControlTemplate x:Key="ContainerControlTemplateKey">
        <ItemsControl ItemsSource="{Binding Layers}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas 
                        Width="{Binding Width}" 
                        Height="{Binding Height}" 
                        Background="{Binding Background, Converter={StaticResource ArgbColorToBrushConverter}}">
                    </Canvas>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <controls:LayerElement/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Width" Value="{Binding Path=DataContext.Width, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Canvas}}, FallbackValue=0.0}" />
                    <Setter Property="Height" Value="{Binding Path=DataContext.Height, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Canvas}}, FallbackValue=0.0}" />
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>
    </ControlTemplate>
    <ControlTemplate x:Key="ContainerEditorControlTemplateKey">
        <Grid Width="{Binding Width}" Height="{Binding Height}" Background="Transparent">
            <Control DataContext="{Binding Template}" Template="{StaticResource ContainerControlTemplateKey}"/>
            <Control DataContext="{Binding}" Template="{StaticResource ContainerControlTemplateKey}"/>
            <controls:EditorCanvas 
                Tag="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                Background="Transparent"
                Focusable="True"
                FocusVisualStyle="{x:Null}"
                Width="{Binding Width}" 
                Height="{Binding Height}">
                <controls:LayerElement DataContext="{Binding WorkingLayer}"/>
                <controls:LayerElement DataContext="{Binding HelperLayer}"/>
            </controls:EditorCanvas>
        </Grid>
    </ControlTemplate>
</ResourceDictionary>
